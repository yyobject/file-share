#!/bin/bash
# File Share - unified entry script
# Auto-detects Python and runs the main script

set -e

# Get script directory
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PYTHON_SCRIPT="${SCRIPT_DIR}/file_share.py"

# Find Python
find_python() {
    if command -v python3 &> /dev/null; then
        echo "python3"
    elif command -v python &> /dev/null; then
        echo "python"
    else
        echo ""
    fi
}

PYTHON=$(find_python)

if [ -z "$PYTHON" ]; then
    echo '{"success": false, "error": "Python not found. Please install Python 3."}' >&2
    exit 1
fi

# Check if dependencies are installed
if ! $PYTHON -c "import oss2, requests" 2>/dev/null; then
    echo "Installing dependencies..." >&2
    if ! $PYTHON -m pip install -q oss2 requests 2>&1; then
        echo '{"success": false, "error": "Failed to install dependencies. Try manually: pip install oss2 requests"}' >&2
        exit 1
    fi
fi

# Execute Python script with all arguments
exec $PYTHON "$PYTHON_SCRIPT" "$@"
